version: '3.4'

services:
  domain:
    image: eshop/domain:${TAG:-latest}
    build:
      context: .
      dockerfile: src/Endpoints/Domain/Dockerfile
    depends_on:
      - rabbitmq
      - eventstore
    restart: always
  mongo:
    image: eshop/mongodb:${TAG:-latest}
    build:
      context: .
      dockerfile: src/Endpoints/MongoDb/Dockerfile
    depends_on:
      - rabbitmq
      - eventstore
      - mongodb
    restart: always
  elastic:
    image: eshop/elastic:${TAG:-latest}
    build:
      context: .
      dockerfile: src/Endpoints/Elastic/Dockerfile
    depends_on:
      - rabbitmq
      - eventstore
      - elasticdb
    restart: always
  presentation:
    image: eshop/presentation:${TAG:-latest}
    build:
      context: .
      dockerfile: src/Endpoints/Presentation/Dockerfile
    depends_on:
      - rabbitmq
    ports:
      - "8080:80"
    restart: always
  frontend:
    image: eshop/frontend:${TAG:-latest}
    build:
      context: .
      dockerfile: src/Web/Dockerfile
    depends_on:
      - presentation
    ports:
      - "80:80"
  
  # windows image
  #rabbitmq:
  #  image: spring2/rabbitmq
  #  ports:
  #    - "15672:15672"
  #    - "5672:5672"

  # linux images
  rabbitmq:
    image: rabbitmq:3-management-alpine
    ports:
      - "15672:15672"
      - "5672:5672"
  eventstore:
    image: eventstore/eventstore
    ports:
      - "1113:1113"
      - "2113:2113"
  mongodb:
    image: mongo:3.7-jessie
    ports:
      - "27017:27017"
  elasticdb:
    image: docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.4
    ports:
      - "9200:9200"
